<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Gauss (Magnetismo) — Dipolo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#20c997;
      --muted:#9aa6b2;
      --card:#0b1220;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:linear-gradient(180deg,#071022 0%, #081428 100%);
      color:#e6eef6;
    }
    .container{
      display:grid;
      grid-template-columns:330px 1fr;
      gap:10px;
      padding:10px;
      height:100vh;
      box-sizing:border-box;
    }
    .panel{
      background:var(--card);
      border-radius:10px;
      padding:12px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    h2{margin:0 0 4px;font-size:18px;}
    label{font-size:13px;color:var(--muted);display:block;margin:4px 0;}
    input[type=range]{width:100%;}
    canvas{
      width:100%;
      height:100%;
      border-radius:8px;
      display:block;
    }
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .btn{
      padding:6px 10px;
      border-radius:8px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.08);
      color:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .small{font-size:12px;color:var(--muted);}
    .legend span{display:block;font-size:12px;color:var(--muted);}
  </style>
</head>
<body>
  <div class="container">
    <!-- PANEL CONTROLES -->
    <div class="panel">
      <div>
        <h2>Gauss (Magnetismo) — Dipolo</h2>
        <div class="small">
          Se representa un imán como dos lazos de corriente opuestos (dipolo).  
          El flujo magnético neto a través de una superficie cerrada es ≈ 0 (no hay monopolos).
        </div>
      </div>

      <div>
        <label><strong>Simulación</strong></label>
        <div class="row">
          <button id="play"  class="btn">Iniciar</button>
          <button id="pause" class="btn">Pausar</button>
          <button id="reset" class="btn">Reset</button>
        </div>
      </div>

      <div>
        <label><strong>Opciones visuales</strong></label>
        <label><input id="show-vectors" type="checkbox" checked> Mostrar campo (vectores)</label>
        <label><input id="show-stream" type="checkbox" checked> Mostrar líneas de campo</label>
      </div>

      <div>
        <label><strong>Velocidad de animación</strong></label>
        <input id="speed" type="range" min="0" max="2" step="0.01" value="1">
      </div>

      <div>
        <label><strong>Parámetros del dipolo</strong></label>
        <div class="small">
          Arrastra el dipolo (clic sobre cualquiera de los lazos).  
          La orientación está fija horizontal (N–S).
        </div>
        <label>Intensidad de corriente (|I|):
          <input id="paramI" type="range" min="0.5" max="5" step="0.1" value="2">
        </label>
        <label>Distancia entre lazos (L):
          <input id="paramL" type="range" min="40" max="220" step="5" value="120">
        </label>
        <label>Radio de cada lazo (a):
          <input id="paramR" type="range" min="25" max="120" step="5" value="60">
        </label>
      </div>

      <div class="legend">
        <span>⊙ lado con corriente “saliente” (similar polo norte)</span>
        <span>⊗ lado con corriente “entrante” (similar polo sur)</span>
        <span>Superficie gaussiana: círculo punteado azul</span>
      </div>

      <div class="small">
        Ley de Gauss para el magnetismo (forma integral):  
        \(\displaystyle \oint_S \vec{B}\cdot d\vec{A} = 0\)
      </div>
    </div>

    <!-- PANEL CANVAS -->
    <div class="panel">
      <canvas id="simCanvas"></canvas>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('simCanvas');
    const ctx     = canvas.getContext('2d');
    const DPR     = window.devicePixelRatio || 1;

    function resize(){
      canvas.width  = canvas.clientWidth * DPR;
      canvas.height = canvas.clientHeight * DPR;
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    resize();
    window.addEventListener('resize', resize);

    // ---- ESTADO DEL DIPOLO ----
    const dipole = {
      cx: canvas.clientWidth/2,
      cy: canvas.clientHeight/2,
      L : 120,  // distancia entre lazos (centro a centro)
      r : 60,   // radio de lazos
      I : 2     // magnitud de la corriente
      // convención: lazo izquierdo I>0 (⊙), lazo derecho I<0 (⊗)
    };

    const particles = [];
    let isPlaying = true;

    const playBtn  = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const resetBtn = document.getElementById('reset');

    playBtn.onclick  = ()=> isPlaying = true;
    pauseBtn.onclick = ()=> isPlaying = false;
    resetBtn.onclick = ()=>{
      dipole.cx = canvas.clientWidth/2;
      dipole.cy = canvas.clientHeight/2;
      dipole.L  = parseFloat(document.getElementById('paramL').value) || 120;
      dipole.r  = parseFloat(document.getElementById('paramR').value) || 60;
      dipole.I  = parseFloat(document.getElementById('paramI').value) || 2;
      particles.length = 0;
      spawnParticles(220);
    };

    // partículas para líneas de campo
    function spawnParticles(n=160){
      for(let i=0;i<n;i++){
        particles.push({
          x:Math.random()*canvas.clientWidth,
          y:Math.random()*canvas.clientHeight,
          age:Math.random()*200
        });
      }
    }
    spawnParticles(220);

    // arrastre del dipolo completo
    let draggingDipole = false;
    let dragOffsetX=0, dragOffsetY=0;

    canvas.addEventListener('mousedown', e=>{
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const {xL,yL,xR,yR} = loopCenters();
      const dL = Math.hypot(x-xL,y-yL);
      const dR = Math.hypot(x-xR,y-yR);

      if(dL <= dipole.r*0.7 || dR <= dipole.r*0.7){
        draggingDipole = true;
        dragOffsetX = x - dipole.cx;
        dragOffsetY = y - dipole.cy;
      }
    });

    window.addEventListener('mousemove', e=>{
      if(!draggingDipole) return;
      const rect = canvas.getBoundingClientRect();
      dipole.cx = e.clientX - rect.left - dragOffsetX;
      dipole.cy = e.clientY - rect.top  - dragOffsetY;
    });

    window.addEventListener('mouseup', ()=> draggingDipole=false);

    // centros de los lazos del dipolo
    function loopCenters(){
      const L = dipole.L;
      return {
        xL: dipole.cx - L/2,
        yL: dipole.cy,
        xR: dipole.cx + L/2,
        yR: dipole.cy
      };
    }

    // ----- CAMPO MAGNÉTICO -----
    function Bz_from_loop(x,y, x0,y0, I, a){
      const dx = x-x0;
      const dy = y-y0;
      const r  = Math.hypot(dx,dy);
      // modelo tipo dipolo simplificado en el plano
      return 220 * I * (a*a) / Math.pow(r*r + a*a, 1.5);
    }

    function Bz_at(x,y){
      const {xL,yL,xR,yR} = loopCenters();
      const a = dipole.r;
      const I = dipole.I;
      let Bz = 0;
      Bz += Bz_from_loop(x,y,xL,yL, +I, a); // lazo izquierdo (⊙)
      Bz += Bz_from_loop(x,y,xR,yR, -I, a); // lazo derecho (⊗)
      return Bz;
    }

    // vector “falso” en el plano para visualizar las líneas (−∇Bz)
    function B_vec_in_plane(x,y){
      const h = 4;
      const dBx = (Bz_at(x+h,y)-Bz_at(x-h,y))/(2*h);
      const dBy = (Bz_at(x,y+h)-Bz_at(x,y-h))/(2*h);
      return {x:-dBx, y:-dBy};
    }

    function drawArrow(x,y,dx,dy,scale=1,color='rgba(200,140,255,0.95)'){
      const len = Math.hypot(dx,dy);
      if(len<1e-3) return;
      const ux = dx/len, uy = dy/len;
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(Math.atan2(uy,ux));
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(len*scale,0);
      ctx.strokeStyle = color;
      ctx.lineWidth = Math.min(2,1+len*0.02);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(len*scale,0);
      ctx.lineTo(len*scale-6,-4);
      ctx.lineTo(len*scale-6,4);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
      ctx.restore();
    }

    function draw(){
      const W = canvas.clientWidth;
      const H = canvas.clientHeight;

      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = '#050814';
      ctx.fillRect(0,0,W,H);

      // rejilla
      ctx.globalAlpha = 0.07;
      ctx.beginPath();
      for(let x=0;x<W;x+=40){ctx.moveTo(x,0);ctx.lineTo(x,H);}
      for(let y=0;y<H;y+=40){ctx.moveTo(0,y);ctx.lineTo(W,y);}
      ctx.strokeStyle = '#1f2937';
      ctx.stroke();
      ctx.globalAlpha = 1;

      const speed = parseFloat(document.getElementById('speed').value) || 1;
      const t = performance.now()*0.001 * speed;

      // actualizar parámetros desde sliders
      dipole.I = parseFloat(document.getElementById('paramI').value) || dipole.I;
      dipole.L = parseFloat(document.getElementById('paramL').value) || dipole.L;
      dipole.r = parseFloat(document.getElementById('paramR').value) || dipole.r;

      const {xL,yL,xR,yR} = loopCenters();

      // dibujar lazos del dipolo
      // lazo izquierda (⊙)
      ctx.beginPath();
      ctx.arc(xL,yL,dipole.r,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,255,255,0.2)';
      ctx.lineWidth=1.4;
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(xL + dipole.r*0.0, yL, 11,0,Math.PI*2);
      ctx.fillStyle='rgba(255,255,140,0.95)';
      ctx.fill();
      ctx.fillStyle='#000';
      ctx.font='13px sans-serif';
      ctx.fillText('⊙', xL-4, yL+4);

      // lazo derecha (⊗)
      ctx.beginPath();
      ctx.arc(xR,yR,dipole.r,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,255,255,0.2)';
      ctx.lineWidth=1.4;
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(xR + dipole.r*0.0, yR, 11,0,Math.PI*2);
      ctx.fillStyle='rgba(120,255,220,0.95)';
      ctx.fill();
      ctx.fillStyle='#000';
      ctx.font='13px sans-serif';
      ctx.fillText('⊗', xR-4, yR+4);

      ctx.fillStyle='#fff';
      ctx.font='11px sans-serif';
      ctx.fillText('I = +'+dipole.I.toFixed(1), xL-dipole.r-10, yL-10);
      ctx.fillText('I = -'+dipole.I.toFixed(1), xR+dipole.r+4,  yR-10);

      const showVectors = document.getElementById('show-vectors').checked;
      const showStream  = document.getElementById('show-stream').checked;

      // vectores de campo
      if(showVectors){
        const step = 40;
        for(let gx=20;gx<W;gx+=step){
          for(let gy=20;gy<H;gy+=step){
            const v = B_vec_in_plane(gx,gy);
            drawArrow(gx,gy,v.x*1.2,v.y*1.2,1,'rgba(200,140,255,0.95)');
          }
        }
      }

      // líneas de campo
      if(showStream){
        particles.forEach(p=>{
          const v = B_vec_in_plane(p.x,p.y);
          p.x += v.x*0.07;
          p.y += v.y*0.07;
          p.age++;

          if(p.x<0 || p.x>W || p.y<0 || p.age>500){
            p.x = Math.random()*W;
            p.y = Math.random()*H;
            p.age = 0;
          }

          ctx.beginPath();
          ctx.moveTo(p.x,p.y);
          ctx.lineTo(p.x-v.x*0.5, p.y-v.y*0.5);
          ctx.strokeStyle='rgba(255,255,255,0.55)';
          ctx.lineWidth=1;
          ctx.stroke();
        });
      }

      // ---- Superficie gaussiana alrededor del dipolo ----
      const Rg = Math.max(dipole.L, 2*dipole.r)*0.8;
      const cx = dipole.cx;
      const cy = dipole.cy;

      ctx.beginPath();
      ctx.arc(cx,cy,Rg,0,Math.PI*2);
      ctx.setLineDash([6,4]);
      ctx.strokeStyle='rgba(120,220,255,0.9)';
      ctx.lineWidth=1.7;
      ctx.stroke();
      ctx.setLineDash([]);

      // estimar flujo neto sobre S
      let fluxApprox = 0;
      const Nsamples = 120;
      for(let i=0;i<Nsamples;i++){
        const ang = 2*Math.PI*i/Nsamples;
        const sx = cx + Rg*Math.cos(ang);
        const sy = cy + Rg*Math.sin(ang);
        const Bz = Bz_at(sx,sy);
        fluxApprox += Bz;   // ΔA absorbida en la constante
      }

      ctx.fillStyle='#fff';
      ctx.font='12px sans-serif';
      ctx.fillText('Superficie cerrada S', cx-Rg-4, cy-Rg-8);
      ctx.fillText('Φ_B (salida) ≈ Φ_B (entrada)', cx+Rg+10, cy-4);
      ctx.fillText('Ley de Gauss: Φ_B ≈ 0 (sin monopolos)', cx+Rg+10, cy+12);
      ctx.fillText('Φ_B (aprox.) = '+fluxApprox.toFixed(1)+'  ≃ 0', cx+Rg+10, cy+28);

      // flechas de flujo que entran y salen
      const Nflux = 20;
      for(let i=0;i<Nflux;i++){
        const ang = 2*Math.PI*i/Nflux;
        const sx = cx + Rg*Math.cos(ang);
        const sy = cy + Rg*Math.sin(ang);
        const Bz = Bz_at(sx,sy);

        const nx = Math.cos(ang);
        const ny = Math.sin(ang);
        const sign = Math.sign(Bz || (i%2?1:-1));
        const L = 22*sign;

        drawArrow(
          sx,sy,
          nx*L,ny*L,
          1,
          sign>0 ? 'rgba(255,255,160,0.95)' : 'rgba(120,180,255,0.95)'
        );
      }

      // HUD
      ctx.fillStyle='rgba(255,255,255,0.04)';
      ctx.fillRect(10,10,360,42);
      ctx.fillStyle='#fff';
      ctx.font='12px sans-serif';
      ctx.fillText('Gauss (Magnetismo) — Dipolo', 18,28);
      ctx.fillStyle='rgba(255,255,255,0.7)';
      ctx.font='11px sans-serif';
      ctx.fillText('Partículas: '+particles.length+'  •  |I|='+dipole.I.toFixed(1), 18,42);
    }

    function loop(){
      if(isPlaying) draw();
      else draw(); // igual se redibuja la escena
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
